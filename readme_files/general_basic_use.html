<html>
<head>
	<title>Basic Use - AddmusicK Readme</title>
	<link href="readme.css" type="text/css" rel="stylesheet">

</head>
<body text="#FFFFFF">
	<h1>Basic Use</h1><br><br>
	
	<h2>Table of Contents</h2>
	<ul>
	<li><a href="#HowDoIInsertedMusic">How do I insert music?</a></li>
	<li><a href="#EvilDotNetFramework">What if I can't use AMKGUI? Or I don't want to? Or my religion disallows it?</a></li>
	<li><a href="#StillUsingOutdatedTXTFiles">What if the music was made for Addmusic405?</a></li>
	<li><a href="#OhAddmusicMYouWerePrettyRevolutionaryButYouSureMadeThingsDifficultDidntYou">What about AddmusicM songs?</a></li>
	<li><a href="#Hey64KilobytesOfARAMIsQuiteALotThankYouVeryMuch">Echo buffer exceeded total space in ARAM?</a></li>
	<li><a href="#GottaGoFast">When the timer drops below 100 seconds and I die, the music doesn't slow back down!</a></li>
	<li><a href="#WhyAreThereTwoIdenticalOverworldMusicTablesAnyway">The overworld songs are mixed up! The "Welcome to Dinosaur Land" music isn't playing!</a></li>
	<li><a href="#ItAlwaysBuggedMeWhenSkyLevelsSoundedLikeTheyTakePlaceInACaveBecauseOfTheSongTheyUsed">My sound effects aren't echoing correctly!</a></li>
	<li><a href="#StickToSlowerTemposGuys">This song seems to be slowing down randomly...</a></li>
	<li><a href="#AhBackwardsCompatibilityAlwaysAFavoriteOfProgrammersEverywhere">Converting older hacks</a></li>
	<li><a href="#TheQuickerBatcherConverter">Using AM4Batch.exe and AMMBatch.exe</a></li></ol>
	
	
	<br><br><hr><br><br>
	
	
	<h2><a id="HowDoIInsertedMusic">How do I insert music?</a></h2>
	
	It's pretty easy.  Just follow these instructions:
	<ol>
	<li><p>Obtain the custom music you with to use.  A large collection of songs to use may be obtained <a href="http://www.smwcentral.net/?p=section&s=smwmusic">here</a>.  Please note that MIDI, MP3, WAV, and other files will not work!  Only the file types obtained at that link are guaranteed to work.</p></li>
	<li><p>Download the song and save the whole ZIP file in the folder labelled "music".</li></p>
	<li><p>Right click the ZIP folder and select "Extract All" if you're using Windows. If you are not using Windows or this option is not available for whatever reason, create a new folder in your "music" folder (named whatever you want) and copy the contents of the ZIP file into this new folder.  You can delete the ZIP file at this point if you wish.</p></li>
	<li><p>Run "AMKGUI" (if you cannot, see below for manual instructions).  To add a new song, simply drag and drop the text file that's in the folder you just created into AMKGUI.  The song will be inserted after your currently selected song.  Alternatively, you can click the "Add new song" button, navigate to the folder you created earlier, and select the text file that contains the music (e.g. "SMB1 Theme.txt").  You can change or remove songs as well by clicking on their appropriate buttons.</p></li>
	<li><p>When you have made the changes you want, hit the "Run" button, then select your ROM.  After a few moments, a window showing the results given by AddmusicK will appear.  If it says that the insertion was successful, then you can just close the program and continue.  Otherwise, see below for solutions to common problems.</p></li>
	<li><p>You can now use custom music.  A file named &ltROMNAME&gt.msc should have appeared when you ran the program.  Lunar Magic can use this to determine the names of your songs, so be sure to keep it in the same directory as your ROM.  Of note: If Lunar Magic is not displaying the song names for some reason, don't worry: your songs are still there. Just use the number beside the song name in AMKGUI in Lunar Magic.<br><br>
	</ol>
	
	<h2><a id="EvilDotNetFramework">What if I can't use AMKGUI? Or I don't want to? Or my religion disallows it?</a></h2>
	
	<ol><li><p>Once you have your song in its own folder in the "music" folder, open up "Addmusic_list.txt".</p></li>
	<li><p>Add a new line at the bottom of the file, type in an unused number, and then the song's filename (including the folder you put it in).  For example, "My Song/My Song.txt" (without the quotes). Make sure not to include the "music" folder in the path ("music/My Song/My Song.txt" without the quotes will not work correctly). This will be the song number that you will use in Lunar Magic.</p></li>
	<li><p>Run the program.  You will be prompted for your ROM name.  Make sure that your ROM is in the same directory as the program and that its name does not contain any spaces, then type in the name and hit ENTER.</p></li>
	<li><p>Some text will appear on the screen describing details of each song you've inserted.  Examine it if you like, then exit the program.</p>
	</ol>
	<br>
	And that's it!  All other instructions are the same as above.
	
	<br><br><h2><a id="StillUsingOutdatedTXTFiles">What if the music was made for Addmusic405?</a></h2>
	<ol>
	<li><p>Open up your song's text file and type "#am4" (without quotes) at the top of the file.  Make sure it's on its own line. Now save the file.</li></p>
	<li><p><i>If your song is sampled</i>, there is one extra step.  Just below the "#am4" you just typed, copy and paste this in there:
	<br>
	<br><code>
	#samples<br>
	{<br>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"XXXXXXXX.bnk"<br>
	}</code><br>
	<br>
	where XXXXXXXX.bnk is the name of the bank file that was included in your song.  So, for example,
	<br>
	<br><code>
	#samples<br>
	{<br>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"samples.bnk"<br>
	}</code><br>
	<br>
	
	Save your file again.
	
	</li></p>
	</ol>

	<br><br><h2><a id="OhAddmusicMYouWerePrettyRevolutionaryButYouSureMadeThingsDifficultDidntYou">What about AddmusicM songs?</a></h2>
	AddmusicM songs require some extra steps:
	<ol>
	<li><p>Open up your song's text file and type "#amm" (without quotes) at the top of the file.  Make sure it's on its own line.  Now save the file.</p></li>
	<li><p>Look for a line or lines that look like sXX_10_14_13_12_16_15_FF or something similar.</p>
		<ul>
		<li><p>If sXX is 00, more likely than not there are no extra samples specified, as it was reserved for the default AddmusicM sample pack (which had less important samples than AddmusicK does).</p></li>
		<li><p>If sXX is 01, more likely than not it is a default AddmusicM add-on pack used to load 00_SMW@9.brr according to AddmusicM's filename, and 0A SMW @9.brr according to AddmusicK's filename.<br>The <tt>#AMMS01</tt> sample group, when used with <tt>#AMMKisoPCM</tt>, will ensure that the $F3 command (which relies on a raw SRCN ID) can work properly with the original SRCN IDs that AddmusicM would have expected.</p></li>
		<li><p>If sXX is 02, more likely than not it is a default AddmusicM add-on pack used to load the remaining samples from the default Super Mario World set that are otherwise not loaded (AddmusicK loads more samples by default than AddmusicM).<br>The <tt>#AMMS02</tt> sample group, when used with <tt>#AMMKisoPCM</tt>, will ensure that the $F3 command (which relies on a raw SRCN ID) can work properly with the original SRCN IDs that AddmusicM would have expected.</p></li>
		<li><p>If sXX is 03, more likely than not it is a default AddmusicM add-on pack used to load a smaller version of 07 SMW @5.brr according to AddmusicK's filename, known as 07_SMW@5_light.brr according to AddmusicM's filename.<br>The <tt>#AMMS03</tt> sample group, when used with <tt>#AMMKisoPCM</tt>, will ensure that the $F3 command (which relies on a raw SRCN ID) can work properly with the original SRCN IDs that AddmusicM would have expected.</p></li>
		</ul>
	</li>
	<li><p>At the top of the file, add the following text:
		<br><code>
	#samples<br>
	{<br>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#AMMKisoPCM<br>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"sample10.brr"<br>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"sample14.brr"<br>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"sample13.brr"<br>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"sample12.brr"<br>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"sample16.brr"<br>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"sample15.brr"<br>
	}</code><br>
	<br>	
	Where "sample10.brr" is the sample in blist.txt at slot 10, "sample14.brr" is the sample in blist.txt at slot 14, etc.  The order of the samples must be in the order that the sXX line specified, so be careful! 
	
	</p></li>
	
	<li><p>Delete the sXX line, save the file, and then exit.</p></li>
	<li><p>Copy the sample files (probably in a folder named "brr" or "samples") into your sample folder.</p></li>
	</ol>
	<br><br>
	Let's look at an example:  
	<ol><li>Suppose the music file's "s" line looks like s09_10_11_14_12_FF.</li>
	<li>Now suppose that that music's "blist.txt" looks something like this:<br>
	<pre>	10  Trumpet.brr
	11  Strings.brr
	12  Bass.brr
	13  Snare.brr
	14  Cymbal.brr
	15  Organ.brr
	16  Choir.brr</pre></li><br>
	<li>Add the #samples definition.</li>
	<li>The first sample would be "Trumpet.brr".  The second, "Strings.brr".  The third, "Cymbal.brr.  The fourth, "Bass.brr".</li>
	<li>All in all, the #samples definition should look like this:<br><code>
	#samples<br>
	{<br>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#AMMKisoPCM<br>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Trumpet.brr"<br>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Strings.brr"<br>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Cymbal.brr"<br>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Bass.brr"<br>
	}</code><br>
	<br></li></ol>
	
	You will need to do some extra work if the song uses the special pulse wave (its presence is most commonly known if the $FA command is used inside the .txt file or if $F3 $09 is present).<br>
	This is because its internal sample ID in AddmusicM is $09, which is incompatible with AddmusicK's sample group configuration, and in particular, is incompatible with the Bonus End global song if you were to just simply overwrite the ID and use a unique sample group. Thus, the quickest way to fix this and retain all default AMK global song compatibility is as following...
	<ol>
	<li>Look inside the MML file for <tt>$F3 $09 $xx</tt> (<tt>xx</tt> being the pitch base value), with and without spaces.</li>
	<li>Replace them with one of the following...
		<ul>
			<li><tt>$F3 $14 $xx</tt>. This works with the above #samples definition with #AMM (which includes "SPECIALWAVE.brr" by default, which is required for this to work).</li>
			<li><tt>("SPECIALWAVE.brr", $xx)</tt>. This gives more flexibility for the sample ID to use, since the sample ID in question is no longer fixed and can be located wherever it is loaded in ARAM. Note that you may have to use <tt>("../SPECIALWAVE.brr", $xx)</tt> if you use the #path directive as well.</li>
	</ol>
	
	<br><br><h2><a id="Hey64KilobytesOfARAMIsQuiteALotThankYouVeryMuch">Echo buffer exceeded total space in ARAM?</a></h2>
	This is an error that may occur with some frequency with older songs (and some new ones under certain circumstances).  If you get this error, there are three possible solutions.  In order of effectiveness:
	<ol>
	<li><p>Open the offending file.  Find the text "#default" and replace it with "#optimized".  If this text does not exist (and the text "#samples" also does not exist), then add the following to the top of the file:	<br><code>
	#samples<br>
	{<br>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#optimized<br>
	}</code><br>
	<br>
	Otherwise, move on to the next step.</p></li>
	<li><p>Find something that looks like "$F1 $XX $YY $ZZ", where XX YY and ZZ are numbers.  Decrease $XX until you don't get any more errors.  This may make the song sound a bit different, however.</p></li>
	<li><p>If you've reached this step, this song is simply too big for your hack.  You will either have to delete some sound effects, filter out some code or remove a global song (explained in the <a href="general_advanced_use.html">advanced section</a>).  This should hopefully never happen, however.</p></li>
	</ol>
	
	<br><br><h2><a id="GottaGoFast">When the timer drops below 100 seconds and I die, the music doesn't slow back down!</a></h2>
	This is a very simple error to fix.  Simply find all songs that should be "immune" to this increase in tempo (such as the death theme, the game over theme, or whatever), and add "#option tempoimmunity" (without the quotes) to the top of the music text file.  That should solve the problem.
	
	<br><br><h2><a id="WhyAreThereTwoIdenticalOverworldMusicTablesAnyway">The overworld songs are mixed up! The "Welcome to Dinosaur Land" music isn't playing!</a></h2>
	Ah, yeah.  This might happen the first time you run the program.  The fixes for these are simple: just reset them in Lunar Magic.  You'll only have to do this once.
	
	<br><br><h2><a id="ItAlwaysBuggedMeWhenSkyLevelsSoundedLikeTheyTakePlaceInACaveBecauseOfTheSongTheyUsed">My sound effects aren't echoing correctly!</a></h2>
	By default AddmusicK disables echo for sound effects.  This is so that, for example, if you're using a song in a sky level, and that song uses an echo effect, your sound effects won't also echo and sound weird.  To turn echo on, here is what you do:
	<ol><li>Download <a href="https://www.smwcentral.net/?p=section&a=details&id=39036">UberASM Tool</a> from SMWCentral or from its <a href="https://github.com/Fernap/UberASMTool">GitHub repository</a>.</li>
	<li>Open up the "levels" folder and create a file with the ".asm" extension (it could be any name but "enable_sfx_echo.asm" is the most straightforward one). Make sure that when you change the extension, you have it enabled in your file viewer, else you still get a ".txt" file but isn't shown to you.</li>
	<li>Open up the file and paste the following code:<br><code>
init:<br>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LDA #$06<br>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STA $1DFA|!addr<br>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RTL<br>
</code></li>
	<li>Open up UberASM Tool's "list.txt" and add it to all levels which should have an echo enabled by putting the level number and name of the ASM file under the "level:" label. For example, for level 105, you add "105 enable_sfx_echo.asm" (without quotes) below "level:". You can als insert multiple codes into a single level by appending a code to the existing entry (e.g. "105 example.asm enable_sfx_echo.asm") or enable echo for all levels by entering a "*" instead of a number for the level number.</li></ol><br>
	And that's it! You can repeat step 4 for any other level.
	
	<br><br>Keep in mind that pre-2.0 UberASM doesn't support multiple codes per level and so all the code has to be added to a single file instead. One potential solution is to copy the following code:<br><code>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LDA #$06<br>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STA $1DFA|!addr<br></code>
	And paste it to the level code right after the "init:" label. This may end up in duplicate code in the final ROM in case the same code runs in levels and only one needs to have echo enabled but in general, the increased use of code space is limited and optimisations are only needed in case you run out of space.
	<br>
	Likewise, there is no way to run code for all levels directly. One solution is to run the code for a specific game mode. The steps are similar to inserting code for a single level, only you place it below "gamemode:", and instead of the level number, you enter either 12 (the game mode where the level is loaded, particularly its graphics) or 13 (the game mode  of the level fade in) for the entry number.

	<br><br>In case you use the old UberASM patch, you need to do the following steps instead:
	<ol><li>In the "code" folder, open up "level_init_code.asm"</li>
	<li>You should see a bunch of labels that look like "<code>levelinit0</code>", "<code>levelinit1</code>", etc.  Go to the label that corresponds to the level you want echoey sound effects in.  For example, for level 105 you'd go to "<code>levelinit105</code>".
	<li>Insert this code <i>after</i> the label but <i>before</i> the <code>RTS</code>:<br><code>
	LDA #$06<br>
	STA $1DFA</code><br>
	<br>
	So all in all, that part of the file should look like this (if we're using level 105):<br><code>
levelinit105:<br>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LDA #$06<br>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STA $1DFA<br>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RTS<br>
levelinit106:<br>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RTS<br>
</code><br>
	(etc.)</li></ol>
	<br>
	And that's it!  Patch uberASM to your hack, and just repeat these steps for any level in which you want sound effects to echo.
	
	<br><br><h2><a id="StickToSlowerTemposGuys">This song seems to be slowing down randomly...</a></h2>
	Add the text "#halvetempo" (without the quotes) at the top of the song's text file before anything else.  Note that this may not work for all songs, however.
	
	
	<br><br><h2><a id="AhBackwardsCompatibilityAlwaysAFavoriteOfProgrammersEverywhere">Converting older hacks</a></h2>
	No extra steps should be necessary in order to convert hacks that currently use AM4 or AMM; just run the program like normal.  However, it is <i><b>highly</b></i> recommended that you make a backup before attempting this!<br>
	<br>
	Note, however, that you will need to either redownload your old songs or convert them manually.  AM4Batch.exe and AMMBatch.exe may help if you decide to go with the latter, as they will automatically add the correct #am4 or #amm identifiers (though you will still need to add the #samples command).

	<br><br><h2><a id="TheQuickerBatcherConverter">Using AM4Batch.exe and AMMBatch.exe</a></h2>
	Both of these are command line programs that append #am4 or #amm to unconverted .txt files.
	<br><br>
	The only arguments you need to provide are a list of .txt files to append #am4 or #amm to. The program will skip over files that already have either these markers or #amk in them, so you shouldn't worry too much about accidentally putting in two markers in there.
	<br><br>
	Please make sure you don't mix up the two when either using the batch programs or appending #am4 and #amm manually: using the wrong one, worst case scenario, can cause a misinterpretation in either the hex commands or the MML syntax that in turn can cause the conversion to either fail outright, output a non-functional SPC file, or even crash the SPC side when it is played in-game.

	<br><br><p>Return to the <a href="../readme.html">main page</a></p><br>
</body>
</html>